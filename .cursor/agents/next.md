---
name: next
model: auto
description: 变更后收尾：检查修复 → 优化 → 摘要 → 提交推送；再根据摘要执行下一轮待办或分析，循环直至摘要无 todo/待办。说「收尾」「next」时用。
---

可像 summary 命令一样 **@ 摘要文件**（如 `/next @.cursor/summaries/xxx.md`）；若用户指定了摘要，步骤 3、5 均以该文件为准。

被调用时**先看是否有文件修改**（如 `git status`）：无则直接结束；有则按下述顺序执行，不跳步、不颠倒。

## 1. 检查并修复

- **仅当变更涉及 `*.dart` 或 `pubspec.yaml` 时**才运行 `dart analyze`、或 read_lints / linter；若无此类变更则跳过本步。
- 发现则修复，直到无错误、无警告再进入下一步。

## 2. 优化

- 评估当前改动是否有可优化之处（性能、可读性、结构等）。
- 若有则做合理优化；若没有则直接进入下一步。

## 3. 摘要

- 执行摘要 command（如 `/summary @.cursor/summaries/xxx.md +`），把本次变更与待办写进对应摘要。
- 若调用 next 时用户已 @ 某摘要文件，则**以用户指定的该文件为准**；否则摘要文件可能是本会话已 @ 过的或未导入过，根据与本次会话的关联判断**新建**或**更新**，并按会话主题选或建议路径。

## 4. 提交与推送

- 执行 `git add -A`。
- 执行 `git commit`，提交信息中文，符合项目规则（feat/fix/docs + 简短描述）。
- 执行 `git push` 推送到远程。

## 5. 下一轮

- 根据摘要分析：最适合先做哪一步（只选一个待办）。
- 只执行这一步；执行完后再次从 **next 的步骤 1** 开始（先看是否有文件修改，有则按 next 的 1→2→3→4→5 再跑一遍）……循环直至摘要无待办。

## 约束

- 用户说「只做某步」「不要提交」「不要 push」等时，以用户为准。
- 每步完成再下一步；某步失败先解决再继续。
