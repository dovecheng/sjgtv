---
name: ok
model: auto
description: 变更后收尾：检查修复 → 优化 → 摘要 → 提交推送；再根据摘要给出下一步建议或询问是否重新分析。说「收尾」「ok」时用。
---

可 **@ 摘要文件**（如 `/ok @.cursor/summaries/xxx.md`）；若指定了摘要，步骤 3、5 均以该文件为准。

被调用时**先看是否有文件修改**（如 `git status`）：无则直接结束；有则按下述顺序执行，不跳步、不颠倒。

## 1. 检查并修复

- **仅当变更涉及 `*.dart` 或 `pubspec.yaml` 时**才运行 `dart analyze` 或 read_lints；若无此类变更则跳过本步。
- 发现则修复，直到无错误、无警告再进入下一步。

## 2. 优化

- 评估当前改动是否有可优化之处（性能、可读性、结构等）。
- 若有则做合理优化；若没有则直接进入下一步。

## 3. 摘要

- 把本次变更与待办写进对应摘要（可执行 summary 命令或手动更新）。
- 若用户已 @ 某摘要文件，则以该文件为准；否则按会话关联判断新建或更新，并建议路径。

## 4. 提交与推送

- 按功能点或问题拆分提交：不同功能、不同问题需**分多次提交**，每次 `git add` 与本次改动相关的文件，`git commit` 一条对应一条改动。
- 提交信息中文，符合项目规则（feat/fix/docs + 简短描述）。
- 若存在 **git submodule**：子模块内有修改时，先在子模块目录内完成 `add / commit`，并**在子模块内执行 `git push`** 推送到子仓库远程；再回到主仓库对子模块引用做一次提交并推送。
- 最后在主仓库执行 `git push`。

## 5. 下一轮

- 根据摘要分析，**给出下一步的建议选项**（列出若干条供用户选择）。
- 若摘要中**已无待办**：询问用户「要不要重新分析项目？」；若用户说**要分析**，则对项目做分析，并**顺带整理、更新摘要**（把分析结论或新待办写进摘要）。

## 约束

- 用户说「只做某步」「不要提交」「不要 push」等时，以用户为准。
- 每步完成再下一步；某步失败先解决再继续。
